{% macro loop(page, parent_loop) %}
    {% if parent_loop|length > 0 %}
        {% set data_level = parent_loop %}
        {% set parent_loop = parent_loop ~ '.' %}
    {% else %}
        {% set data_level = 0 %}
    {% endif %}
    {% for p in page.children.visible %}
        {% set parent_page = p.activeChild ? ' parent' : '' %}
        {% set current_page = p.active ? ' active' : '' %}
        <li class="dd-item{{ parent_page }}{{ current_page }}" data-nav-level='{{ data_level }}' data-nav-id="{{ p.route }}">
            <a href="{{ p.url }}">
                <i class="fa fa-check read-icon"></i>
                <span><b>{% if data_level == 0 %}{{ loop.index }}. {% endif %}</b>{{ p.menu }}</span>
            </a>
            {% if p.children.count > 0 %}
            <ul>
                {{ _self.loop(p, parent_loop~loop.index) }}
            </ul>
            {% endif %}
        </li>
    {% endfor %}
{% endmacro %}

{% macro version(p) %}
    {% set parent_page = p.activeChild ? ' parent' : '' %}
    {% set current_page = p.active ? ' active' : '' %}
    <h3 class="{{ parent_page }}{{ current_page }}">
        <a href="{{ p.url }}">{{ p.menu }}</a>
    </h3>
{% endmacro %}

{% if theme_config.top_level_version %}
    {% set version_docs = [] %}
    <div id="version-picker">
        <span>Version:</span>
        <select id="version">
            {% for p in pages.children %}
                <option value="{{ p.slug }}">{{ p.menu }}</option>
                {% if p.children.count > 0 %}
                    {% set version_docs = version_docs|merge({(p.slug) : p}) %}
                {% endif %}
            {% endfor %}
        </select>
    </div>

    {% for slug, docs in version_docs %}
        {{ _self.version(docs) }}
        <ul id="{{ slug }}" class="topics">
        {{ _self.loop(docs, '') }}
        </ul>
    {% endfor %}

{% else %}
    <ul class="topics">
    {{ _self.loop(pages, '') }}
    </ul>
{% endif %}


<hr />

<a class="padding" href="#" data-clear-history-toggle><i class="fa fa-fw fa-history"></i> Clear History</a><br />

